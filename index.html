<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ペンギンVS目玉ボス 2Dプラットフォーマー</title>
    <style>
        #gameCanvas {
            border: 1px solid black;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // プレイヤーの設定
        const player = {
            x: 50,
            y: 200,
            width: 40,
            height: 40,
            speed: 5,
            jumpPower: 10,
            velocityY: 0,
            isJumping: false,
            direction: 1,
            isDead: false
        };

        // ボスの設定
        const boss = {
            x: 400,
            y: 100,
            radius: 30,
            speed: 3,
            health: 100,
            fireballCooldown: 1000,
            lastFireballTime: 0,
            diveCooldown: 5000,
            lastDiveTime: 0,
            isDiving: false,
            diveSpeed: 8
        };

        // その他の設定
        const bullets = [];
        const fireballs = [];
        const bulletSpeed = 10;
        const bulletCooldown = 500;
        let lastBulletTime = 0;
        const gravity = 0.5;
        const keys = {};

        // プレイヤーの描画
        function drawPixel(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, 1, 1);
        }

        function drawPenguin(x, y, direction) {
            const penguinPixels = [
                [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
                [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
                [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
                [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
                [0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0],
                [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
                [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
                [0,0,0,1,1,0,1,1,1,1,0,1,1,0,0,0],
                [0,0,1,1,1,1,0,1,1,0,1,1,1,1,0,0],
                [0,1,1,1,1,1,1,0,0,1,1,1,1,1,1,0],
                [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
                [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
                [0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0],
                [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
                [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
                [0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0]
            ];

            const scale = 2.5;
            const gunOffsetX = direction === 1 ? 16 * scale : -4 * scale;
            const gunOffsetY = 6 * scale;

            for (let i = 0; i < penguinPixels.length; i++) {
                for (let j = 0; j < penguinPixels[i].length; j++) {
                    if (penguinPixels[i][j] === 1) {
                        const pixelX = x + (direction === 1 ? j : 15 - j) * scale;
                        const pixelY = y + i * scale;
                        drawPixel(pixelX, pixelY, 'black');
                    }
                }
            }

            // 銃の描画
            ctx.fillStyle = 'gray';
            ctx.fillRect(x + gunOffsetX, y + gunOffsetY, 12 * (direction === 1 ? 1 : -1), 4);
        }

        // ボスの描画
        function drawBoss() {
            ctx.beginPath();
            ctx.arc(boss.x, boss.y, boss.radius, 0, Math.PI * 2);
            ctx.fillStyle = 'white';
            ctx.fill();
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.stroke();

            const irisRadius = boss.radius * 0.6;
            const irisX = boss.x + (player.x - boss.x) * 0.2;
            const irisY = boss.y + (player.y - boss.y) * 0.2;
            ctx.beginPath();
            ctx.arc(irisX, irisY, irisRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'blue';
            ctx.fill();

            const pupilRadius = irisRadius * 0.4;
            const pupilX = irisX + (player.x - boss.x) * 0.1;
            const pupilY = irisY + (player.y - boss.y) * 0.1;
            ctx.beginPath();
            ctx.arc(pupilX, pupilY, pupilRadius, 0, Math.PI * 2);
            ctx.fillStyle = 'black';
            ctx.fill();

            // ヘルスバーの描画
            ctx.fillStyle = 'red';
            ctx.fillRect(boss.x - boss.radius, boss.y - boss.radius - 10, boss.radius * 2, 5);
            ctx.fillStyle = 'green';
            ctx.fillRect(boss.x - boss.radius, boss.y - boss.radius - 10, (boss.radius * 2) * (boss.health / 100), 5);
        }

        // 弾丸の描画
        function drawBullet(x, y) {
            ctx.fillStyle = 'yellow';
            ctx.beginPath();
            ctx.arc(x, y, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        // 火の玉の描画
        function drawFireball(x, y) {
            ctx.fillStyle = 'orange';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
        }

        // 弾を撃つ処理
        function shootBullet() {
            const currentTime = Date.now();
            if (currentTime - lastBulletTime > bulletCooldown) {
                const bulletX = player.direction === 1 ? player.x + player.width : player.x;
                const bulletY = player.y + player.height / 2;
                bullets.push({ x: bulletX, y: bulletY, direction: player.direction });
                lastBulletTime = currentTime;
            }
        }

        // ボスの火の玉を撃つ処理
        function bossShootFireball() {
            const currentTime = Date.now();
            if (currentTime - boss.lastFireballTime > boss.fireballCooldown) {
                const angle = Math.atan2(player.y - boss.y, player.x - boss.x);
                fireballs.push({
                    x: boss.x,
                    y: boss.y,
                    velocityX: Math.cos(angle) * 5,
                    velocityY: Math.sin(angle) * 5
                });
                boss.lastFireballTime = currentTime;
            }
        }

        // 入力処理
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // 更新処理
        function update() {
            if (keys['ArrowRight']) {
                player.x += player.speed;
                player.direction = 1;
            }
            if (keys['ArrowLeft']) {
                player.x -= player.speed;
                player.direction = -1;
            }
            if (keys['Space'] && !player.isJumping) {
                player.velocityY = -player.jumpPower;
                player.isJumping = true;
            }
            if (keys['z'] || keys['Z']) {
                shootBullet();
            }

            // 重力の適用
            player.velocityY += gravity;
            player.y += player.velocityY;
            if (player.y > 200) {
                player.y = 200;
                player.isJumping = false;
            }

            // 弾の移動
            bullets.forEach((bullet, index) => {
                bullet.x += bulletSpeed * bullet.direction;
                if (bullet.x > canvas.width || bullet.x < 0) {
                    bullets.splice(index, 1); // 画面外に出たら弾を削除
                }
            });

            // ボスの火の玉の移動
            fireballs.forEach((fireball, index) => {
                fireball.x += fireball.velocityX;
                fireball.y += fireball.velocityY;

                // 火の玉がプレイヤーに当たるかチェック
                if (fireball.x > player.x && fireball.x < player.x + player.width &&
                    fireball.y > player.y && fireball.y < player.y + player.height) {
                    player.isDead = true;
                }

                if (fireball.x > canvas.width || fireball.x < 0 || fireball.y > canvas.height || fireball.y < 0) {
                    fireballs.splice(index, 1); // 画面外に出たら火の玉を削除
                }
            });

            // 弾がボスに当たったかチェック
            bullets.forEach((bullet, index) => {
                const dist = Math.sqrt((bullet.x - boss.x) ** 2 + (bullet.y - boss.y) ** 2);
                if (dist < boss.radius) {
                    boss.health -= 10;
                    bullets.splice(index, 1); // 当たったら弾を削除
                }
            });

            // ボスがプレイヤーに突進する処理
            const currentTime = Date.now();
            if (currentTime - boss.lastDiveTime > boss.diveCooldown) {
                boss.isDiving = true;
                boss.lastDiveTime = currentTime;
            }

            if (boss.isDiving) {
                boss.y += boss.diveSpeed;
                if (boss.y > canvas.height - boss.radius || boss.y < boss.radius) {
                    boss.diveSpeed *= -1; // 上下反転
                }
                if (Math.abs(boss.y - player.y) < 5) {
                    player.isDead = true; // ボスがプレイヤーに衝突
                }
            }

            // ボスが倒されたか
            if (boss.health <= 0) {
                alert('勝利！ボスを倒しました！');
                resetGame();
            }

            // プレイヤーが死亡したか
            if (player.isDead) {
                alert('ゲームオーバー');
                resetGame();
            }

            bossShootFireball();
        }

        // 描画処理
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPenguin(player.x, player.y, player.direction);
            drawBoss();

            bullets.forEach(bullet => drawBullet(bullet.x, bullet.y));
            fireballs.forEach(fireball => drawFireball(fireball.x, fireball.y));
        }

        // ゲームのリセット
        function resetGame() {
            player.x = 50;
            player.y = 200;
            player.isDead = false;
            player.velocityY = 0;

            boss.x = 400;
            boss.y = 100;
            boss.health = 100;
            boss.isDiving = false;

            bullets.length = 0;
            fireballs.length = 0;
        }

        // メインループ
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>

